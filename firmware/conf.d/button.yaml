# Button is pin on the side of the ESP32s2
# Connected to pin 8
binary_sensor:
  - platform: gpio
    pin:
      number: 0
      mode: INPUT_PULLUP
      inverted: true
    name: "Button"
    internal: true
    state_topic:
    filters:
      - delayed_off: 10s
    on_press:
      then:
        - globals.set:
            id: button_press_duration
            value: '0'
        - script.execute: start_timer
        #TODO: start flashing led

    on_release:
      then:
        - script.stop: timer_script
        - if:
            condition:
              and:
                - lambda: 'return id(button_press_duration) >= 10;'
            then:
              - logger.log: "Erasing WiFi credentials and restarting..."
              - button.press: factory_reset_openspool


globals:
  - id: my_counter
    type: int
    initial_value: '0'
  - id: button_press_duration
    type: int
    initial_value: '0'

script:
  - id: timer_script
    mode: restart
    then:
      - globals.set:
          id: button_press_duration
          value: !lambda "return id(button_press_duration) + 1;"
      - delay: 1s
      - script.execute: timer_script

  - id: start_timer
    then:
      - globals.set:
          id: button_press_duration
          value: '0'
      - script.execute: timer_script

button:
  - platform: factory_reset
    name: Restart with Factory Default Settings
    id: factory_reset_openspool
