substitutions:
  name: openspool
  rfid1_spi_interface: "any" #spi2 on PCB
  rfid1_clk_pin: "GPIO39" #36 on PCB
  rfid1_miso_pin: "GPIO37"
  rfid1_mosi_pin: "GPIO35"
  rfid1_ss_pin: "GPIO33" #34 on PCB

esphome:
  name: ${name} #Don't use underscore '_' in name https://esphome.io/guides/faq.html#why-shouldn-t-i-use-underscores-in-my-device-name
  name_add_mac_suffix: true
  platformio_options:
    build_unflags: -std=gnu++11
    build_flags: -std=gnu++14
    # upload_speed: 115200 # Wemos D1 Mini from Aliexpress struggle at 460800 baud rate
  on_boot:
    then:
      - script.execute: set_led_rainbow
      - delay: 3s
      - lambda: |-
          //TODO: this appears to have broken and no longer blinks blue
          if (!wifi::global_wifi_component->is_connected() && 
              wifi::global_wifi_component->wifi_soft_ap_ip().str() == "192.168.4.1") {
            id(set_led_breathing_blue).execute();
          }
      # - lambda: |-
      #     id(my_ota).set_auth_password("New password");
  on_shutdown:
    then:
      - script.execute: set_led_off

esp32:
  board: lolin_s2_mini
  variant: esp32s2
  framework:
    type: esp-idf

logger:
# MQTT and api are not compatible: https://esphome.io/components/mqtt.html
# api:
#   reboot_timeout: 0s
# ota:

packages:
  uptime: !include conf.d/uptime.yaml
  wifi: !include conf.d/wifi.yaml
  web_server: !include conf.d/web_server.yaml
  #debug: !include conf.d/debug.yaml
  # time: !include conf.d/time.yaml
  status_led: !include conf.d/status_led.yaml
  mqtt_bambu_lan: !include conf.d/mqtt_bambu_lan.yaml
  button: !include conf.d/button.yaml
  filament: !include conf.d/filament.yaml
  bambu_printer: !include conf.d/bambu_printer.yaml
  rc532_rfid: !include conf.d/rc532_rfid.yaml
  automation: !include conf.d/automation.yaml
  leds: !include conf.d/leds.yaml
  #improv: !include conf.d/improv.yaml
  #ota: !include conf.d/ota.yaml
  # bambu_ams: !include conf.d/bambu_ams.yaml
